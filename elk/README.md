# ELK系统搭建

## 一、前言

### 1.1 日志系统主要用来解决两类问题：
1. 微服务场景下服务众多，服务链较长且都散布在不同的云主机上，通过日志分析问题往往巫需要登陆不同的主机，查看不同的服务，问题处理比较耗时；
2. 各服务之间的日志没有索引关联，无法快速的对一个完整的请求进行分析处理；
3. 问题往往由客户或者运维人员反馈，收到问题反馈往往已经在问题发生一段事件以后，无法在服务异常的第一时间感知，及时处理，降低风险；

### 1.2 如何解决？
1. **统一格式**（各微服务由不同语言开发，日志杂而格式不统一，将这些日志进行统一收集处理比较困难，所以首先需要各服务对日志格式进行统一修改）；
2. **统一收集** (通过市场上现有的日志采集器对微服务所在的各个虚机上的日志进行统一收集，集中处理);
3. **统一分析 + 告警** (日志收集后开发可以通过kibana进行日志的统一查看分析，增加告警功能后可以在服务异常的第一时间内通知到相关人员快速处理)

## 二、架构图
![](../../logproxy/log/logserver.png)

- 说明：
  1. 日志通过filebeat从各个主机上的日志目录采集，集中存储到kafka集群中；
  2. 日志通过LogStash导入到ES集群中，通过kibana进行分析查阅、通过kibana自带插件 **sentinl** 进行分析告警;
  3. 其他人可通过订阅kafka中的topic来获取到自己感兴趣的服务日志；
  
## 三、环境部署
### 3.1 单节点安装
- [kibana安装使用指导](doc/kinbana/kinbana.md)
- [filebeat安装使用指导](doc/filebeat/filebeat.md)
- [elasticsearch安装使用指导](doc/elasticsearch/elasticsearch.md)
- [kafka安装使用指导](doc/kafka/kafka.md)
- [logstash安装使用指导](doc/logstash/logstash.md)

### 3.2 k8s集群内安装
<code> // TODO </code>



## 四、遗留问题 

1. 从filebate采集到kibana的日志实时展示有5s左右的延迟，当服务数量多日志量大时，延迟时间会不会增加？是否可以接受？

2. 是否接受将所有日志汇总到一个topic中？如果不接受如何解决单个filebeat实例只能将日志推送到同一个kafka同一个topic中的问题?

## 五、同道中人

> 1. https://blog.csdn.net/df007df/article/details/54781305 (一个哥们与我们使用一样的方案)



